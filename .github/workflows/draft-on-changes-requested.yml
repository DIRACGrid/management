name: Draft on Changes Requested

on:
  workflow_call:
    inputs:
      pr_number:
        required: true
        type: number

jobs:
  convert-to-draft:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
    steps:
      - name: Convert PR to draft
        uses: actions/github-script@v7
        with:
          script: |
            const { data: pr } = await github.rest.pulls.get({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: ${{ inputs.pr_number }},
            });

            if (pr.draft) {
              core.info("PR is already a draft, skipping.");
              return;
            }

            await github.graphql(`
              mutation($id: ID!) {
                convertPullRequestToDraft(input: { pullRequestId: $id }) {
                  pullRequest { isDraft }
                }
              }
            `, { id: pr.node_id });

            core.info(`Converted PR #${{ inputs.pr_number }} to draft.`);
